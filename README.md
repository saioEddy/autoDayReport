# 自动化日报提交程序

自动发现本地Git仓库，生成每日提交清单的日报程序。

**✅ 跨平台支持**: 支持 macOS、Linux 和 Windows 系统

## 功能特性

1. **自动发现Git仓库**: 递归搜索指定目录下的所有Git仓库
2. **获取今日提交**: 自动获取所有仓库中今日的所有提交记录
3. **生成提交清单**: 按作者和仓库分组，生成格式化的提交清单
4. **保存日报**: 自动保存日报到文件

## 项目结构

```
自动化日报提交/
├── service/           # 服务层（业务逻辑）
│   ├── git_service.py      # Git仓库服务
│   └── report_service.py   # 日报生成服务
├── main.py            # 主程序入口
├── config.py          # 配置文件
├── requirements.txt   # 依赖文件
└── reports/           # 日报保存目录（自动创建）
```

## 系统要求

- Python 3.6+
- Git 已安装并配置在系统PATH中

## 使用方法

### 1. 运行程序

**macOS/Linux:**
```bash
python3 main.py
```

**Windows:**
```cmd
python main.py
```

### 2. 配置搜索路径

程序会自动尝试以下路径（按优先级）：
1. 环境变量 `GIT_REPO_SEARCH_PATH` 指定的路径
2. `~/Documents/开发代码` (macOS/Linux)
3. `~/Documents` (通用)
4. `~/projects` 或 `~/Projects` (常见项目目录)
5. `~/code` (常见代码目录)
6. 用户主目录 `~` (最后备选)

**macOS/Linux 设置环境变量:**
```bash
export GIT_REPO_SEARCH_PATH=/path/to/your/projects
python3 main.py
```

**Windows 设置环境变量:**
```cmd
# 临时设置（当前会话）
set GIT_REPO_SEARCH_PATH=C:\Users\YourName\Documents\Projects
python main.py

# 永久设置（系统环境变量）
# 在"系统属性" -> "环境变量"中添加 GIT_REPO_SEARCH_PATH
```

或者在 `config.py` 中修改 `GIT_REPO_SEARCH_PATH` 配置。

### 3. 定时任务（可选）

#### macOS/Linux (使用crontab)

```bash
# 编辑crontab
crontab -e

# 添加每日18:00执行的任务
0 18 * * * cd /Users/sai0/Documents/开发代码/自动化日报提交 && /usr/bin/python3 main.py
```

#### Windows (使用任务计划程序)

1. 打开"任务计划程序" (Task Scheduler)
2. 创建基本任务
3. 设置触发器为"每天"
4. 设置操作为"启动程序"
5. 程序路径填写Python解释器完整路径，例如：`C:\Python39\python.exe`
6. 参数填写：`main.py`
7. 起始于填写：程序所在目录的完整路径，例如：`C:\Users\YourName\Documents\自动化日报提交`

## 输出示例

日报会保存到 `reports/日报_YYYYMMDD.txt` 文件，内容格式如下：

```
# 工作日报 - 2026年01月26日

## 今日提交清单

============================================================
今日提交清单 - 2026年01月26日
============================================================

【张三】
------------------------------------------------------------
  仓库: project-a
    [abc1234] 2026-01-26 14:30:00 - 修复登录bug
    [def5678] 2026-01-26 16:20:00 - 添加新功能

【李四】
------------------------------------------------------------
  仓库: project-b
    [ghi9012] 2026-01-26 10:15:00 - 更新文档

============================================================
统计信息:
  总提交数: 3
  参与人员: 2
  涉及仓库: 2
============================================================
```

## 跨平台兼容性说明

### 路径处理
- 程序使用 `os.path` 模块处理路径，自动适配不同操作系统的路径分隔符
- Windows路径（`C:\Users\...`）和Unix路径（`/home/...`）都能正确处理

### Git命令
- 程序使用 `shutil.which()` 自动检测Git命令位置
- Windows上会自动查找 `git.exe`，无需特殊配置
- 确保Git已安装并添加到系统PATH环境变量中

### 权限处理
- 程序包含异常处理，遇到无权限访问的目录会自动跳过并继续搜索
- Windows上某些系统目录（如 `AppData`）会被自动排除

## 注意事项

1. **搜索范围**: 程序会递归搜索指定目录，如果目录很大可能会花费较长时间。建议通过环境变量指定具体的项目目录，而不是搜索整个用户主目录。

2. **Git要求**: 确保Git已正确安装。可以通过以下命令检查：
   ```bash
   # macOS/Linux
   which git
   
   # Windows
   where git
   ```

3. **文件保存**: 日报文件保存在程序目录下的 `reports/` 文件夹中，按日期命名（格式：`日报_YYYYMMDD.txt`）

4. **编码支持**: 程序使用UTF-8编码保存文件，支持中文等非ASCII字符

5. **Windows用户**: 如果遇到"git不是内部或外部命令"错误，请确保：
   - Git已正确安装
   - Git的bin目录已添加到系统PATH环境变量
   - 重启命令行窗口或IDE使环境变量生效
